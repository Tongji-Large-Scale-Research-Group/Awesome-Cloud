
# Awesome-Cloud 周刊（第 16 期）：前沿论文-Eva: Cost-Efficient Cloud-Based Cluster Scheduling

这里简单记录每周分享的前沿内容，不定期发布。


---

## 1. 为什么 - 背景需求

### 批处理工作负载

- 固定集群 —— 针对ML工作负载  
  - 专注于高效利用昂贵的加速器（如GPU）  
  - 主流方案：专用、固定大小的集群  

- 固定集群 —— 传统调度程序  
  - 目标：最小化JCT、最大化资源利用率  

### 云中的批量计算

- 弊端：有研究表明，集群内大数据和 ML的资源请求是突发的，并且会随着时间的变化而波动，这会导致在固定大小的集群中，资源的利用率不足和使用效率低。

- 云计算：按需扩展、即用即付  

### 产生的变化：需要新的调度机制

- 云集群的灵活性增加调度复杂性  
- 实例类型多样、成本不同  
- 资源按需预置，消除等待时间  
- 调度目标：  
  - 从最小化JCT转变为最小化总配置成本  
  - 保持吞吐量不变  
  - 优化任务调度和实例配置（实例数量、类型、任务分配）

---

## 1. 为什么 - 现有方案不足

### 作业的资源需求不同

- 未考虑互补资源  
  - 可将互补资源任务放在一起，减少空闲资源和实例数量  
  - 在基于云的集群环境中，任务合作可改善资源分配并减少需要的实例数量，从而降低总成本，然而，大多数现有的云调度器并没有考虑到这一点。


### 共置任务干扰

- 未考虑成本影响  
  - 共存任务共享LLC、磁盘IO、网络带宽  
  - 干扰导致性能下降，增加实例运行时间和总成本，之前的工作将共址干扰的影响纳入集群调度器中。Paragon 和 Quasar 使用协同滤波来估计干扰对任务的影响，而 Owl则直接预先分析干扰。根据这些信息，他们的调度程序避免了可能导致彼此严重干扰的任务放在一起，从而满足用户指定的服务质量。

  

### 集群配置更新

- 迁移策略过于保守  
  - 需定量评估迁移开销与节省成本的关系  
  - 最佳配置会随时间变化，需重新配置  
  - 要采用定量方法来评估迁移开销和在集群重新配置节省的成本，在二者之间权衡，从而最大限度地降低总成本


---

## 2. 做什么 - 创新点

### 研究挑战与创新点

- 调度目标变化 + 未考虑互补资源  
- 共置干扰未考虑成本  
- 迁移策略保守  

---

## 2. 做什么 - 算法设计

### 启发式思想

- 类似一维VSBPP启发式：大bin优先 + 大球优先  
- 目标：最小化成本，减少资源碎片  

### Reservation Price

- 实例按每小时成本评估“size”  
- 任务的Reservation Price：满足资源需求的最便宜实例的成本  

---

## Full Reconfiguration 算法

- 按成本降序遍历实例类型  
- 优先高成本实例（如GPU）  
- 按预留价格打包任务  
- 判断是否成本效益后添加实例到配置中  
- 重复直到处理完所有实例类型  

---

## Throughput-Normalized Reservation Price

- 解决共置干扰  
- 任务τ的标准化吞吐量：tput_τ  
- 判断分配是否成本效益：标准化预留价格 > 实际成本  
- 使用 Co-location Throughput Table 维护  
- 吞吐量动态学习与估计  

---

## 多任务作业干扰影响

- 同一作业内任务之间依赖，共置干扰影响整个作业吞吐量  

---

## 迁移感知

### Partial Reconfiguration 算法

- 只考虑子集任务重新配置  
- 限制迁移，减小实例变动  

### 集成方法

- 每周期运行 Full 和 Partial 两种算法  
- 对比节省（SF、SP）和迁移开销（MF、MP）  
- 决定采用哪种方案  
- 设定配置维持时间D  

---

## 3. 怎么做 - 系统实现

### Eva 系统架构

- 用户提交包含多个任务的作业  
- 未知吞吐量 → Profiler 估计  
- 周期性调度（如每5分钟）  
- Scheduler 决定配置  
- Provisioner 启动/终止实例  
- Executor 启动/迁移任务  
- ThroughputMonitor 在线学习，维护共置吞吐量表  

---

## 4. 怎么做 - 系统实现

### 实现

- 使用 Python 实现 Eva + simulator  
- 模块化架构，Master-Worker 模型  
- Master 通过云 API 管理实例  
- 每个实例启动 worker，gRPC 通信  
- 用户只需提供 Dockerfile 和资源需求  

---

## 4. 怎么样 - 基于 AWS EC2 的物理实验

### 实验设置

- AWS EC2：P3（GPU）、C7i（计算优化）、R7i（内存优化）共21种实例类型  
- 10种批处理工作负载（ML & 科学计算）  
- 小规模：32个作业，大规模：120个作业  
- 泊松到达，平均间隔20分钟  

### 对比算法

- No-Packing Scheduler  
- Stratus  
- Owl  
- Synergy  

### 指标

- 成本  
- 资源分配比率  
- JCT  

---

## 4. 怎么样 - 模拟实验

### 实验设置

- 使用阿里巴巴GPU作业公开跟踪（cluster-trace-gpu-v2023）  
- 单任务作业视作独立任务  
- 高比例短作业：80% < 1小时，半程 < 11分钟  
- 使用 Gavel 模型长期作业  

### 对比算法

- 同上  

---

## 5. Future Work

- JCT 比基线大，因目标是最小化成本 → 后续优化方向  
- 扩展至更多负载类型，适用于多种任务环境  

---

---

## 6. 问答记录
### Q1:FULL RECONFIGURATION 算法和partialreconfiguration算法的区别？

- Full Reconfiguration 算法：每次调度都重新配置整个集群，适用于资源类型多样、成本不同、资源按需预置的场景。
- Partial Reconfiguration 算法：只考虑子集任务重新配置，适用于资源类型多样、成本不同、资源按需预置的场景。
-partial reconfiguration算法的提出是为了降低迁移成本，否则每提交一个任务就要重新配置一次，成本会很高。

### Q2:Partial Reconfiguration 算法中所说子集任务具体是什么？

- 子集任务：指的是当前未提交和完成的任务，即当前集群中有部分任务正在运行，而部分任务的资源需求发生变化。

### Q3：throughput-normalized reservation price的公式表示是什么？
- throughput-normalized reservation price的公式表示为：TNPR（t,T）=tput(t,T)*RP(t)

### Q4：论文中提到的多个任务之间的共置干扰，连乘公式合理吗
- 论文中提到的多个任务之间的共置干扰，是指同一作业内的多个任务之间存在依赖关系，共置干扰会影响整个作业的吞吐量。
- 连乘公式的合理性需要进一步考量，这是一个值得思考的好问题，很有启发性。
---


